{"version":3,"file":"aksLoader.js","sourceRoot":"","sources":["../../../src/agent/aksLoader.ts"],"names":[],"mappings":";AAAA,uCAAuC;AACvC,kCAAkC;;;AAElC,yBAAyB;AACzB,6BAA6B;AAC7B,qEAAkE;AAClE,iEAA8D;AAC9D,6DAA0D;AAC1D,+CAA4C;AAC5C,mCAAgF;AAGhF,MAAa,SAAU,SAAQ,yBAAW;IAEtC;QACI,KAAK,EAAE,CAAC;QACR,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,6BAA6B;YAC7B,IAAI,CAAC,QAAQ,CAAC,wBAAwB,GAAG;gBACrC,OAAO,EAAE,IAAI;aAChB,CAAC;YAEF,IAAI,YAAY,GAAG,+BAA+B,CAAC;YACnD,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjB,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE;oBAClB,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,EAAE,qBAAqB,EAAE,QAAQ,CAAC,CAAC;iBAC3F;qBACI;oBACD,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,WAAW,EAAE,qBAAqB,EAAE,eAAe,EAAE,UAAU,EAAE,qBAAqB,EAAE,QAAQ,CAAC,CAAC;iBAC3I;aACJ;YACD,IAAI,CAAC,aAAa,GAAG,IAAI,2BAAY,CAAC,IAAI,CAAC,mBAAmB,EAAE,IAAI,uBAAU,CAAC,YAAY,EAAE,oBAAoB,EAAE;gBAC/G,MAAM,EAAE,KAAK;gBACb,YAAY,EAAE,KAAK;gBACnB,YAAY,EAAE,WAAW;gBACzB,SAAS,EAAE,IAAI,GAAG,IAAI;aACzB,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,iBAAiB,GAAG,IAAI,mCAAgB,CACzC,IAAI,CAAC,mBAAmB,EACxB,IAAI,uBAAU,CACV,YAAY,EACZ,mCAAmC,EACnC;gBACI,MAAM,EAAE,IAAI;gBACZ,YAAY,EAAE,KAAK;gBACnB,YAAY,EAAE,WAAW;gBACzB,SAAS,EAAE,IAAI,GAAG,IAAI,EAAE,OAAO;aAClC,CACJ,CACJ,CAAC;YACF,OAAO,CAAC,GAAG,CAAC,kCAA0B,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,iCAAyB,CAAC,GAAG,CAAC,CAAC;SACnG;IACL,CAAC;CACJ;AA1CD,8BA0CC","sourcesContent":["// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport * as os from 'os';\r\nimport * as path from 'path';\r\nimport { DiagnosticLogger } from './diagnostics/diagnosticLogger';\r\nimport { FileWriter } from \"./diagnostics/writers/fileWriter\";\r\nimport { StatusLogger } from \"./diagnostics/statusLogger\";\r\nimport { AgentLoader } from \"./agentLoader\";\r\nimport { AgentResourceProviderType, AZURE_MONITOR_AGENT_PREFIX } from './types';\r\n\r\n\r\nexport class AKSLoader extends AgentLoader {\r\n\r\n    constructor() {\r\n        super();\r\n        if (this._canLoad) {\r\n            // AKS specific configuration\r\n            this._options.otlpMetricExporterConfig = {\r\n                enabled: true\r\n            };\r\n\r\n            let statusLogDir = '/var/log/applicationinsights/';\r\n            if (this._isWindows) {\r\n                if (process.env.HOME) {\r\n                    statusLogDir = path.join(process.env.HOME, \"LogFiles\", \"ApplicationInsights\", \"status\");\r\n                }\r\n                else {\r\n                    statusLogDir = path.join(os.tmpdir(), \"Microsoft\", \"ApplicationInsights\", \"StatusMonitor\", \"LogFiles\", \"ApplicationInsights\", \"status\");\r\n                }\r\n            }\r\n            this._statusLogger = new StatusLogger(this._instrumentationKey, new FileWriter(statusLogDir, 'status_nodejs.json', {\r\n                append: false,\r\n                deleteOnExit: false,\r\n                renamePolicy: 'overwrite',\r\n                sizeLimit: 1024 * 1024,\r\n            }));\r\n\r\n            this._diagnosticLogger = new DiagnosticLogger(\r\n                this._instrumentationKey,\r\n                new FileWriter(\r\n                    statusLogDir,\r\n                    'applicationinsights-extension.log',\r\n                    {\r\n                        append: true,\r\n                        deleteOnExit: false,\r\n                        renamePolicy: 'overwrite',\r\n                        sizeLimit: 1024 * 1024, // 1 MB\r\n                    }\r\n                )\r\n            );\r\n            process.env[AZURE_MONITOR_AGENT_PREFIX] = this._getVersionPrefix(AgentResourceProviderType.aks);\r\n        }\r\n    }\r\n}\r\n"]}